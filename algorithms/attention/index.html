<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨æ„åŠ›æœºåˆ¶å¯è§†åŒ– - MLTutor</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/algorithm.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .attention-viz {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            padding: 20px;
            min-height: 300px;
        }
        .token-box {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 300px;
        }
        .token {
            padding: 8px 16px;
            background: #374151;
            border-radius: 6px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        .token:hover {
            border-color: #3b82f6;
        }
        .token.source {
            background: #3b82f6;
        }
        .token.target {
            background: #10b981;
        }
        .attention-line {
            stroke: #f59e0b;
            stroke-width: 2;
            fill: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .attention-line.active {
            opacity: 1;
        }
        .attention-weight {
            position: absolute;
            background: #1f2937;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
        }
        .matrix-cell {
            transition: all 0.3s;
        }
        .position-viz {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        .embeddings {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .embedding-bar {
            height: 8px;
            border-radius: 2px;
            transition: all 0.3s;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <a href="../../index.html" class="back-link">â† è¿”å›çŸ¥è¯†å›¾è°±</a>
            <h1 class="algo-title">æ³¨æ„åŠ›æœºåˆ¶å¯è§†åŒ–</h1>
        </nav>

        <div class="content-wrapper">
            <main class="main-area">
                <section class="intro-section">
                    <h2>ä»€ä¹ˆæ˜¯æ³¨æ„åŠ›æœºåˆ¶ï¼Ÿ</h2>
                    <div class="intro-content">
                        <p><strong>æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismï¼‰</strong> æ˜¯ä¸€ç§è®©ç¥ç»ç½‘ç»œä¸“æ³¨äºè¾“å…¥é‡è¦éƒ¨åˆ†çš„æŠ€æœ¯ã€‚</p>
                        <p><strong>æ ¸å¿ƒç›´è§‰ï¼š</strong></p>
                        <ul>
                            <li>å°±åƒé˜…è¯»æ—¶é‡ç‚¹å…³æ³¨æŸäº›è¯ä¸€æ ·</li>
                            <li>ç»™æ¯ä¸ªè¾“å…¥åˆ†é…ä¸åŒçš„"æƒé‡"</li>
                            <li>æƒé‡è¶Šå¤§ï¼Œè¡¨ç¤ºè¶Š"å…³æ³¨"</li>
                        </ul>
                        <p><strong>ä¸ºä»€ä¹ˆéœ€è¦æ³¨æ„åŠ›ï¼Ÿ</strong></p>
                        <ul>
                            <li>RNN/LSTM å¤„ç†é•¿åºåˆ—æ—¶ä¿¡æ¯ä¸¢å¤±</li>
                            <li>å¹¶è¡Œè®¡ç®—ï¼ˆå¦‚ Transformerï¼‰éœ€è¦å…¨å±€ä¿¡æ¯</li>
                            <li>æé«˜æ¨¡å‹å¯è§£é‡Šæ€§</li>
                        </ul>
                    </div>
                </section>

                <section class="visualization-section">
                    <h2>äº¤äº’å¼å¯è§†åŒ–</h2>
                    <p style="color: #6c787d; margin-bottom: 15px;">ç‚¹å‡»æŸ¥è¯¢è¯ï¼Œè§‚å¯Ÿå…¶ä¸æ‰€æœ‰é”®è¯çš„æ³¨æ„åŠ›æƒé‡</p>

                    <div class="viz-controls">
                        <div class="control-group">
                            <label>ç¤ºä¾‹å¥å­:</label>
                            <select id="sentence-select">
                                <option value="translation">æœºå™¨ç¿»è¯‘ (ä¸­â†’è‹±)</option>
                                <option value="sentiment">æƒ…æ„Ÿåˆ†æ</option>
                                <option value="summary">æ–‡æœ¬æ‘˜è¦</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>æ³¨æ„åŠ›ç±»å‹:</label>
                            <select id="attention-type">
                                <option value="additive">Additive (Bahdanau)</option>
                                <option value="dot">Dot Product</option>
                                <option value="scaled">Scaled Dot-Product</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>æ¸©åº¦ (T):</label>
                            <input type="range" id="temperature" min="0.1" max="2" step="0.1" value="1">
                            <span id="temperature-value" class="value-display">1</span>
                        </div>
                        <div class="control-group">
                            <button id="reset-btn" class="btn btn-secondary">é‡ç½®</button>
                        </div>
                    </div>

                    <div class="viz-container">
                        <div id="attention-viz" class="attention-viz"></div>
                    </div>

                    <div style="margin-top: 20px;">
                        <h4>æ³¨æ„åŠ›æƒé‡çŸ©é˜µ</h4>
                        <div id="attention-matrix"></div>
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: var(--bg-color); border-radius: 8px;">
                        <h4 style="margin-bottom: 10px;">æŸ¥è¯¢(Query)ã€é”®(Key)ã€å€¼(Value) æ¦‚å¿µï¼š</h4>
                        <div style="display: flex; gap: 30px; font-size: 14px;">
                            <div>
                                <strong style="color: #3b82f6;">Query (æŸ¥è¯¢):</strong> æˆ‘æ­£åœ¨å¯»æ‰¾ä»€ä¹ˆï¼Ÿ
                            </div>
                            <div>
                                <strong style="color: #10b981;">Key (é”®):</strong> æˆ‘èƒ½æä¾›ä»€ä¹ˆï¼Ÿ
                            </div>
                            <div>
                                <strong style="color: #f59e0b;">Value (å€¼):</strong> å®é™…å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ
                            </div>
                        </div>
                    </div>
                </section>

                <section class="math-section">
                    <h2>æ•°å­¦åŸç†</h2>
                    <div class="math-content">
                        <p><strong>1. ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆScaled Dot-Product Attentionï¼‰ï¼š</strong></p>
                        <p>$$\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V$$</p>
                        <ul>
                            <li>$Q \in \mathbb{R}^{n \times d_k}$: æŸ¥è¯¢çŸ©é˜µ</li>
                            <li>$K \in \mathbb{R}^{n \times d_k}$: é”®çŸ©é˜µ</li>
                            <li>$V \in \mathbb{R}^{n \times d_v}$: å€¼çŸ©é˜µ</li>
                            <li>$d_k$: é”®å‘é‡çš„ç»´åº¦</li>
                        </ul>

                        <p><strong>2. è®¡ç®—æ­¥éª¤ï¼š</strong></p>
                        <ol>
                            <li>è®¡ç®—æ³¨æ„åŠ›åˆ†æ•°ï¼š$\text{scores} = QK^T$</li>
                            <li>ç¼©æ”¾ï¼š$\text{scaled} = \text{scores} / \sqrt{d_k}$</li>
                            <li>Softmax å½’ä¸€åŒ–ï¼š$\text{weights} = \text{softmax}(\text{scaled})$</li>
                            <li>åŠ æƒæ±‚å’Œï¼š$\text{output} = \text{weights} \times V$</li>
                        </ol>

                        <p><strong>3. å¤šå¤´æ³¨æ„åŠ›ï¼š</strong></p>
                        <p>$$\text{MultiHead}(Q, K, V) = \text{Concat}(\text{head}_1, ..., \text{head}_h)W^O$$</p>
                        <p>ä½¿ç”¨å¤šç»„ Qã€Kã€V å¹¶è¡Œè®¡ç®—ï¼Œæ•æ‰ä¸åŒçš„æ³¨æ„åŠ›æ¨¡å¼ã€‚</p>
                    </div>
                </section>
            </main>

            <aside class="sidebar">
                <div class="notebook-card">
                    <h3>ğŸ““ Jupyter Notebook</h3>
                    <p>åŠ¨æ‰‹å®ç°æ³¨æ„åŠ›æœºåˆ¶ï¼Œç†è§£ Transformer åŸºç¡€</p>
                    <div class="notebook-actions">
                        <a href="notebook.ipynb" class="btn btn-primary">æ‰“å¼€ Notebook</a>
                    </div>
                    <div class="notebook-preview">
                        <p>åŒ…å«å†…å®¹ï¼š</p>
                        <ul class="notebook-features">
                            <li>ä»é›¶å®ç° Self-Attention</li>
                            <li>Multi-Head Attention</li>
                            <li>ä½ç½®ç¼–ç </li>
                            <li>æ„å»ºå°å‹ Transformer</li>
                        </ul>
                    </div>
                </div>

                <div class="quick-nav">
                    <h3>ç›¸å…³ç®—æ³•</h3>
                    <ul class="quick-nav-list">
                        <li><a href="../rnn/index.html">RNN å¾ªç¯ç¥ç»ç½‘ç»œ</a></li>
                        <li><a href="../cnn/index.html">CNN å·ç§¯ç¥ç»ç½‘ç»œ</a></li>
                        <li><a href="../nn/index.html">ç¥ç»ç½‘ç»œ</a></li>
                    </ul>
                </div>

                <div class="level-info">
                    <h3>å¯è§†åŒ–ç­‰çº§</h3>
                    <span class="level-badge level-4">Level 4</span>
                    <p>æ³¨æ„åŠ› Â· æƒé‡å¯è§†åŒ– Â· Transformer åŸºç¡€</p>
                </div>
            </aside>
        </div>
    </div>

    <script src="../../assets/js/attention.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false}
                ],
                throwOnError: false
            });
        });
    </script>
</body>
</html>
